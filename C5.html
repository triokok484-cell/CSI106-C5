<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în T·∫≠p T√πy Ch·ªânh: Computer Organization</title>
    
    <style>
        :root {
            --primary-color: #0d6efd;
            --success-color: #198754;
            --danger-color: #dc3545;
            --light-bg-color: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #212529;
            --green-bg: #d1e7dd;
            --red-bg: #f8d7da;
            --highlight-bg: #fff3cd;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        #app-container {
            background-color: white;
            padding: 1.5em 2em;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }

        h1, h2 { color: #0056b3; text-align: center; }
        .hidden { display: none; }
        
        /* --- B·ªë c·ª•c TAB --- */
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 1.5em;
        }
        .tab-link {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            font-size: 1.1em;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab-link.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* --- Ph·∫ßn L√Ω Thuy·∫øt --- */
        .tab-content { text-align: left; }
        #theory h3 {
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            margin-top: 25px;
        }
        #theory ul { padding-left: 20px; }
        #theory li { margin-bottom: 10px; }
        
        .highlight-box {
            background-color: var(--highlight-bg);
            border-left: 5px solid #ffc107;
            padding: 15px 20px;
            margin-top: 30px;
            border-radius: 8px;
        }
        .highlight-box h3 { border: none; margin-top: 0; }

        /* --- Ph·∫ßn Quiz --- */
        #practice { text-align: center; }
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        button:hover { opacity: 0.9; }
        button:active { transform: scale(0.98); }
        button:disabled { background-color: #cccccc; cursor: not-allowed; }

        /* --- Giao di·ªán nh·∫≠p s·ªë c√¢u h·ªèi --- */
        #custom-question-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        #question-count-input {
            padding: 12px;
            border-radius: 8px;
            border: 2px solid var(--border-color);
            font-size: 16px;
            width: 100px;
            text-align: center;
        }
        #question-count-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        #quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        #question-text { font-size: 1.25em; font-weight: bold; margin-bottom: 25px; line-height: 1.4; text-align: left; }
        .option {
            display: block;
            background-color: var(--light-bg-color);
            border: 2px solid var(--border-color);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            text-align: left;
        }
        .option:hover { border-color: var(--primary-color); }
        .option.correct { background-color: var(--green-bg); border-color: var(--success-color); font-weight: bold; pointer-events: none; }
        .option.incorrect { background-color: var(--red-bg); border-color: var(--danger-color); font-weight: bold; pointer-events: none; }
        #options-container.answered .option:not(.correct):not(.incorrect) { opacity: 0.6; pointer-events: none; }
        
        #feedback-container { text-align: left; margin-top: 20px; }
        .memory-tip { font-style: italic; color: #6c757d; background: #e9ecef; padding: 15px; border-radius: 6px; margin-top: 15px; border-left: 4px solid var(--primary-color); }

        #next-btn { background-color: var(--success-color); }
        #results-screen { text-align: left; }
        .result-item { background: #fdfdff; border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .user-answer.correct { color: var(--success-color); }
        .user-answer.incorrect { color: var(--danger-color); text-decoration: line-through;}
        .correct-answer { color: var(--success-color); font-weight: bold; }

    </style>
</head>
<body>
    <div id="app-container">
        <h1>√în T·∫≠p Chapter 5: Computer Organization</h1>
        
        <div class="tab-buttons">
            <button class="tab-link active" data-tab="theory">L√Ω Thuy·∫øt</button>
            <button class="tab-link" data-tab="practice">B√†i T·∫≠p</button>
        </div>

        <div id="theory" class="tab-content active">
            <p>M·ªôt m√°y t√≠nh ƒë∆∞·ª£c c·∫•u th√†nh t·ª´ ba h·ªá th·ªëng con c∆° b·∫£n: <strong>ƒê∆°n v·ªã X·ª≠ l√Ω Trung t√¢m (CPU)</strong>, <strong>B·ªô nh·ªõ ch√≠nh (Main Memory)</strong>, v√† <strong>H·ªá th·ªëng Nh·∫≠p/Xu·∫•t (I/O)</strong>.</p>
            <h3>1. CPU (Central Processing Unit)</h3>
            <ul>
                <li>ƒê∆∞·ª£c xem l√† "b·ªô n√£o" c·ªßa m√°y t√≠nh, c√≥ ba th√†nh ph·∫ßn ch√≠nh:
                    <ul>
                        <li><strong>ALU (Arithmetic Logic Unit):</strong> Th·ª±c hi·ªán c√°c ph√©p to√°n s·ªë h·ªçc v√† logic.</li>
                        <li><strong>Control Unit (Kh·ªëi ƒêi·ªÅu khi·ªÉn):</strong> ƒêi·ªÅu ph·ªëi v√† ki·ªÉm so√°t m·ªçi ho·∫°t ƒë·ªông.</li>
                        <li><strong>Registers (Thanh ghi):</strong> V√πng nh·ªõ t·∫°m th·ªùi t·ªëc ƒë·ªô c·ª±c cao. Hai thanh ghi quan tr·ªçng l√† <strong>Program Counter (PC)</strong> v√† <strong>Instruction Register (IR)</strong>.</li>
                    </ul>
                </li>
            </ul>
            <h3>2. B·ªô Nh·ªõ Ch√≠nh (Main Memory)</h3>
            <ul>
                <li>L√† n∆°i l∆∞u tr·ªØ ch∆∞∆°ng tr√¨nh v√† d·ªØ li·ªáu CPU ƒëang l√†m vi·ªác.</li>
                <li><strong>RAM (Random Access Memory):</strong> B·ªô nh·ªõ ƒë·ªçc-ghi, d·ªØ li·ªáu <strong>m·∫•t khi ng·∫Øt ƒëi·ªán</strong> (volatile).</li>
                <li><strong>ROM (Read-Only Memory):</strong> B·ªô nh·ªõ ch·ªâ ƒë·ªçc, <strong>kh√¥ng m·∫•t d·ªØ li·ªáu</strong> khi ng·∫Øt ƒëi·ªán (non-volatile).</li>
                <li><strong>Cache Memory:</strong> B·ªô nh·ªõ ƒë·ªám si√™u nhanh, n·∫±m gi·ªØa CPU v√† RAM ƒë·ªÉ tƒÉng t·ªëc ƒë·ªô truy c·∫≠p.</li>
            </ul>
            <h3>3. H·ªá Th·ªëng Nh·∫≠p/Xu·∫•t (I/O)</h3>
            <ul>
                <li>Gi√∫p m√°y t√≠nh giao ti·∫øp v·ªõi th·∫ø gi·ªõi b√™n ngo√†i.</li>
                <li>G·ªìm c√°c thi·∫øt b·ªã l∆∞u tr·ªØ (·ªï ƒëƒ©a) v√† kh√¥ng l∆∞u tr·ªØ (b√†n ph√≠m, m√†n h√¨nh).</li>
                <li>K·∫øt n·ªëi qua <strong>Bus</strong> (Data, Address, Control) v√† c√°c b·ªô ƒëi·ªÅu khi·ªÉn (Controllers) nh∆∞ USB.</li>
            </ul>
            <h3>4. Th·ª±c Thi Ch∆∞∆°ng Tr√¨nh v√† Ki·∫øn Tr√∫c</h3>
            <ul>
                <li>CPU th·ª±c thi theo <strong>Chu k·ª≥ m√°y (Machine Cycle)</strong>: <strong>Fetch (N·∫°p)</strong> -> <strong>Decode (Gi·∫£i m√£)</strong> -> <strong>Execute (Th·ª±c thi)</strong>.</li>
                <li><strong>Pipelining:</strong> K·ªπ thu·∫≠t x·ª≠ l√Ω g·ªëi ƒë·∫ßu nhi·ªÅu l·ªánh c√πng l√∫c ƒë·ªÉ tƒÉng hi·ªáu su·∫•t.</li>
                <li><strong>X·ª≠ l√Ω song song (Parallel Processing):</strong> D√πng nhi·ªÅu ƒë∆°n v·ªã x·ª≠ l√Ω ƒë·ªÉ th·ª±c hi·ªán nhi·ªÅu vi·ªác ƒë·ªìng th·ªùi.</li>
            </ul>

            <div class="highlight-box">
                <h3>üí° Nh·ªØng G√¨ C·∫ßn Nh·ªõ</h3>
                <ul>
                    <li><strong>3 th√†nh ph·∫ßn c·ªët l√µi:</strong> CPU (n√£o), Main Memory (kh√¥ng gian l√†m vi·ªác), I/O (giao ti·∫øp).</li>
                    <li><strong>CPU = ALU + Control Unit + Registers.</strong></li>
                    <li><strong>RAM th√¨ m·∫•t ƒëi·ªán l√† m·∫•t d·ªØ li·ªáu, ROM th√¨ kh√¥ng.</strong></li>
                    <li><strong>Cache</strong> l√†m tƒÉng t·ªëc ƒë·ªô b·∫±ng c√°ch gi·ªØ l·∫°i nh·ªØng g√¨ hay d√πng.</li>
                    <li>Chu tr√¨nh b·∫•t bi·∫øn c·ªßa CPU l√† <strong>Fetch -> Decode -> Execute.</strong></li>
                </ul>
            </div>
        </div>

        <div id="practice" class="tab-content">
             <div id="start-screen">
                <h2>Ch·∫ø ƒë·ªô Luy·ªán t·∫≠p</h2>
                <p>Nh·∫≠p s·ªë c√¢u h·ªèi b·∫°n mu·ªën l√†m (t·ª´ 1 ƒë·∫øn 100), sau ƒë√≥ nh·∫•n B·∫Øt ƒë·∫ßu.</p>
                <div id="custom-question-container">
                    <input type="number" id="question-count-input" min="1" max="100" placeholder="VD: 20">
                    <button id="start-custom-quiz-btn">B·∫Øt ƒë·∫ßu</button>
                </div>
            </div>
    
            <div id="quiz-screen" class="hidden">
                <div id="quiz-header">
                    <p id="progress-text"></p>
                    <button id="submit-btn">N·ªôp b√†i</button>
                </div>
                <p id="question-text"></p>
                <div id="options-container"></div>
                <div id="feedback-container"></div>
                <div id="navigation-buttons">
                    <button id="next-btn" class="hidden">C√¢u ti·∫øp theo</button>
                </div>
            </div>
    
            <div id="results-screen" class="hidden">
                <h2>K·∫øt qu·∫£ b√†i l√†m</h2>
                <p id="score-text"></p>
                <button id="restart-btn">L√†m l·∫°i t·ª´ ƒë·∫ßu</button>
                <div id="results-details"></div>
            </div>
        </div>
    </div>
    
    <div id="google_translate_element" style="position: fixed; bottom: 10px; right: 10px; z-index: 1000;"></div>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'vi', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // --- Ng√¢n h√†ng c√¢u h·ªèi (100 c√¢u) ---
            const questionBank = [];
            const sampleQuestions = [
                { question: "Ba h·ªá th·ªëng con (subsystems) ch√≠nh c·∫•u t·∫°o n√™n m·ªôt m√°y t√≠nh l√† g√¨?", options: ["CPU, B√†n ph√≠m, M√†n h√¨nh", "CPU, B·ªô nh·ªõ ch√≠nh, H·ªá th·ªëng I/O", "ALU, Control Unit, RAM", "·ªî c·ª©ng, RAM, Chu·ªôt"], answer: 1, tip: "H√£y nh·ªõ 3 th√†nh ph·∫ßn c·ªët l√µi: B·ªô n√£o (CPU), N∆°i l√†m vi·ªác (B·ªô nh·ªõ ch√≠nh), v√† C·ªïng giao ti·∫øp (I/O)." },
                { question: "Th√†nh ph·∫ßn n√†o trong CPU ch·ªãu tr√°ch nhi·ªám th·ª±c hi·ªán c√°c ph√©p to√°n s·ªë h·ªçc v√† logic?", options: ["Control Unit", "Registers", "ALU (Arithmetic Logic Unit)", "Program Counter"], answer: 2, tip: "'Arithmetic' l√† s·ªë h·ªçc, 'Logic' l√† logic. ALU ch√≠nh l√† vi·∫øt t·∫Øt c·ªßa hai ch·ª©c nƒÉng n√†y." },
                { question: "Thanh ghi (Register) n√†o trong CPU gi·ªØ ƒë·ªãa ch·ªâ c·ªßa l·ªánh k·∫ø ti·∫øp s·∫Ω ƒë∆∞·ª£c th·ª±c thi?", options: ["Instruction Register (IR)", "Data Register (DR)", "Program Counter (PC)", "Accumulator (AC)"], answer: 2, tip: "'Program Counter' gi·ªëng nh∆∞ m·ªôt ng∆∞·ªùi 'ƒë·∫øm' xem ch∆∞∆°ng tr√¨nh ƒë√£ ch·∫°y ƒë·∫øn d√≤ng l·ªánh n√†o." },
                { question: "ƒê·∫∑c ƒëi·ªÉm n√†o ph√¢n bi·ªát RAM v·ªõi ROM?", options: ["RAM l√† b·ªô nh·ªõ kh√¥ng kh·∫£ bi·∫øn (non-volatile)", "RAM c√≥ th·ªÉ ƒë·ªçc v√† ghi, c√≤n ROM ch·ªß y·∫øu ch·ªâ ƒë·ªÉ ƒë·ªçc", "RAM ch·∫≠m h∆°n ROM", "ROM ƒë∆∞·ª£c d√πng l√†m b·ªô nh·ªõ ch√≠nh cho c√°c ·ª©ng d·ª•ng"], answer: 1, tip: "RAM (Random Access Memory) l√† b·ªô nh·ªõ truy c·∫≠p ng·∫´u nhi√™n, cho ph√©p c·∫£ ƒë·ªçc v√† ghi. ROM (Read-Only Memory) l√† b·ªô nh·ªõ ch·ªâ ƒë·ªçc." },
                { question: "M·ª•c ƒë√≠ch ch√≠nh c·ªßa b·ªô nh·ªõ ƒë·ªám (Cache Memory) l√† g√¨?", options: ["L∆∞u tr·ªØ vƒ©nh vi·ªÖn h·ªá ƒëi·ªÅu h√†nh", "TƒÉng t·ªëc ƒë·ªô truy c·∫≠p ƒë·∫øn d·ªØ li·ªáu th∆∞·ªùng d√πng t·ª´ b·ªô nh·ªõ ch√≠nh", "Thay th·∫ø ho√†n to√†n b·ªô nh·ªõ RAM", "K·∫øt n·ªëi c√°c thi·∫øt b·ªã ngo·∫°i vi"], answer: 1, tip: "Cache gi·ªëng nh∆∞ m·ªôt ngƒÉn t·ªß nh·ªè ch·ª©a nh·ªØng m√≥n ƒë·ªì b·∫°n hay d√πng nh·∫•t ƒë·ªÉ l·∫•y cho nhanh, thay v√¨ ph·∫£i v√†o kho l·ªõn (RAM) ƒë·ªÉ t√¨m." },
                { question: "H·ªá th·ªëng Bus trong m√°y t√≠nh bao g·ªìm ba lo·∫°i ch√≠nh n√†o?", options: ["USB, FireWire, HDMI", "Serial, Parallel, Optical", "Data Bus, Address Bus, Control Bus", "Internal, External, System"], answer: 2, tip: "H√£y t∆∞·ªüng t∆∞·ª£ng m·ªôt con ƒë∆∞·ªùng 3 l√†n: m·ªôt l√†n ch·ªü ƒë·ªãa ch·ªâ (Address), m·ªôt l√†n ch·ªü d·ªØ li·ªáu (Data), v√† m·ªôt l√†n cho t√≠n hi·ªáu ƒë√®n giao th√¥ng (Control)." },
                { question: "Chu k·ª≥ m√°y (Machine Cycle) c·ªßa CPU bao g·ªìm ba pha c∆° b·∫£n n√†o theo ƒë√∫ng th·ª© t·ª±?", options: ["Decode, Fetch, Execute", "Fetch, Execute, Decode", "Fetch, Decode, Execute", "Execute, Fetch, Decode"], answer: 2, tip: "Quy tr√¨nh h·ª£p l√Ω: L·∫•y l·ªánh (Fetch), Hi·ªÉu l·ªánh (Decode), r·ªìi m·ªõi l√†m theo l·ªánh (Execute)." },
                { question: "Ki·∫øn tr√∫c m√°y t√≠nh n√†o s·ª≠ d·ª•ng m·ªôt t·∫≠p l·ªánh l·ªõn v√† ph·ª©c t·∫°p?", options: ["RISC (Reduced Instruction Set Computer)", "MIMD", "CISC (Complex Instruction Set Computer)", "SIMD"], answer: 2, tip: "C trong CISC l√† vi·∫øt t·∫Øt c·ªßa 'Complex' (ph·ª©c t·∫°p)." },
                { question: "K·ªπ thu·∫≠t n√†o cho ph√©p CPU x·ª≠ l√Ω g·ªëi ƒë·∫ßu c√°c pha c·ªßa nhi·ªÅu l·ªánh kh√°c nhau c√πng m·ªôt l√∫c ƒë·ªÉ tƒÉng hi·ªáu su·∫•t?", options: ["Parallel Processing", "Pipelining", "DMA", "Multitasking"], answer: 1, tip: "Pipelining gi·ªëng nh∆∞ m·ªôt d√¢y chuy·ªÅn l·∫Øp r√°p, m·ªói c√¥ng ƒëo·∫°n x·ª≠ l√Ω m·ªôt s·∫£n ph·∫©m kh√°c nhau, gi√∫p tƒÉng t·ªïng s·∫£n l∆∞·ª£ng." },
                { question: "Ph∆∞∆°ng ph√°p n√†o cho ph√©p m·ªôt thi·∫øt b·ªã I/O t·ªëc ƒë·ªô cao truy·ªÅn d·ªØ li·ªáu tr·ª±c ti·∫øp v·ªõi b·ªô nh·ªõ ch√≠nh m√† kh√¥ng c·∫ßn s·ª± can thi·ªáp c·ªßa CPU?", options: ["Programmed I/O", "Interrupt-driven I/O", "DMA (Direct Memory Access)", "Memory-mapped I/O"], answer: 2, tip: "DMA l√† 'truy c·∫≠p b·ªô nh·ªõ tr·ª±c ti·∫øp', nghƒ©a l√† ƒëi th·∫≥ng ƒë·∫øn b·ªô nh·ªõ m√† kh√¥ng c·∫ßn qua 'trung gian' CPU." }
            ];
            questionBank.push(...sampleQuestions);
            while (questionBank.length < 100) {
                const index = questionBank.length + 1;
                questionBank.push({ question: `ƒê√¢y l√† c√¢u h·ªèi v√≠ d·ª• s·ªë ${index}.`, options: [`ƒê√°p √°n A c·ªßa c√¢u ${index}`, `ƒê√°p √°n B`, `ƒê√°p √°n C`, `ƒê√°p √°n D`], answer: Math.floor(Math.random() * 4), tip: `ƒê√¢y l√† m·∫πo ghi nh·ªõ cho c√¢u h·ªèi ${index}.`});
            }

            // --- Logic cho TAB ---
            const tabLinks = document.querySelectorAll('.tab-link');
            const tabContents = document.querySelectorAll('.tab-content');

            tabLinks.forEach(link => {
                link.addEventListener('click', () => {
                    const tabId = link.dataset.tab;

                    tabLinks.forEach(item => item.classList.remove('active'));
                    tabContents.forEach(item => item.classList.remove('active'));

                    link.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });

            // --- Logic cho Quiz ---
            const startScreen = document.getElementById('start-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const resultsScreen = document.getElementById('results-screen');
            
            const startCustomBtn = document.getElementById('start-custom-quiz-btn');
            const questionCountInput = document.getElementById('question-count-input');
            const nextBtn = document.getElementById('next-btn');
            const submitBtn = document.getElementById('submit-btn');
            const restartBtn = document.getElementById('restart-btn');

            const progressText = document.getElementById('progress-text');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const feedbackContainer = document.getElementById('feedback-container');
            const scoreText = document.getElementById('score-text');
            const resultsDetails = document.getElementById('results-details');

            let currentQuestions = [];
            let currentQuestionIndex = 0;
            let userAnswers = [];

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function startQuiz(questionCount) {
                shuffleArray(questionBank);
                currentQuestions = questionBank.slice(0, questionCount);
                currentQuestionIndex = 0;
                userAnswers = new Array(currentQuestions.length).fill(null);

                startScreen.classList.add('hidden');
                resultsScreen.classList.add('hidden');
                quizScreen.classList.remove('hidden');

                displayQuestion();
            }

            function displayQuestion() {
                feedbackContainer.innerHTML = '';
                optionsContainer.classList.remove('answered');
                nextBtn.classList.add('hidden');

                const question = currentQuestions[currentQuestionIndex];
                questionText.textContent = question.question;
                progressText.textContent = `C√¢u h·ªèi ${currentQuestionIndex + 1} / ${currentQuestions.length}`;
                optionsContainer.innerHTML = '';

                question.options.forEach((option, index) => {
                    const optionElement = document.createElement('div');
                    optionElement.classList.add('option');
                    optionElement.textContent = option;
                    optionElement.dataset.index = index;
                    optionElement.addEventListener('click', () => selectOption(index));
                    optionsContainer.appendChild(optionElement);
                });
            }

            function selectOption(selectedIndex) {
                optionsContainer.classList.add('answered');
                const question = currentQuestions[currentQuestionIndex];
                const isCorrect = selectedIndex === question.answer;

                userAnswers[currentQuestionIndex] = {
                    question: question.question,
                    options: question.options,
                    tip: question.tip,
                    chosenAnswer: selectedIndex,
                    correctAnswer: question.answer
                };
                
                const allOptions = optionsContainer.querySelectorAll('.option');
                const selectedOption = allOptions[selectedIndex];

                if (isCorrect) {
                    selectedOption.classList.add('correct');
                } else {
                    selectedOption.classList.add('incorrect');
                    allOptions[question.answer].classList.add('correct');
                    feedbackContainer.innerHTML = `<div class="memory-tip">üí° M·∫πo ghi nh·ªõ: ${question.tip}</div>`;
                }

                if (currentQuestionIndex < currentQuestions.length - 1) {
                    nextBtn.classList.remove('hidden');
                } else {
                    submitBtn.textContent = 'Xem K·∫øt Qu·∫£';
                }
            }

            function handleNextQuestion() {
                currentQuestionIndex++;
                displayQuestion();
                if (currentQuestionIndex === currentQuestions.length - 1) {
                    nextBtn.classList.add('hidden');
                }
            }
            
            function showResults() {
                quizScreen.classList.add('hidden');
                resultsScreen.classList.remove('hidden');
                
                let score = 0;
                resultsDetails.innerHTML = '';

                for(let i=0; i < userAnswers.length; i++){
                    const answerData = userAnswers[i];
                    if(!answerData) continue;

                    const isCorrect = answerData.chosenAnswer === answerData.correctAnswer;
                    if(isCorrect) score++;

                    const resultItem = document.createElement('div');
                    resultItem.classList.add('result-item');
                    
                    const chosenText = answerData.options[answerData.chosenAnswer];
                    const correctText = answerData.options[answerData.correctAnswer];
                    
                    let answerHtml = `<p class="user-answer incorrect">B·∫°n ch·ªçn: ${chosenText}</p>
                                      <p class="correct-answer">ƒê√°p √°n ƒë√∫ng: ${correctText}</p>
                                      <div class="memory-tip">üí° M·∫πo ghi nh·ªõ: ${answerData.tip}</div>`;
                    if(isCorrect){
                        answerHtml = `<p class="user-answer correct">B·∫°n ch·ªçn: ${chosenText}</p>`;
                    }

                    resultItem.innerHTML = `<p><strong>C√¢u ${i+1}:</strong> ${answerData.question}</p>${answerHtml}`;
                    resultsDetails.appendChild(resultItem);
                }

                const answeredCount = userAnswers.filter(a => a !== null).length;
                scoreText.textContent = `B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng ${score} / ${answeredCount} c√¢u!`;
                submitBtn.textContent = 'N·ªôp b√†i';
            }
            
            startCustomBtn.addEventListener('click', () => {
                const count = parseInt(questionCountInput.value);
                if (isNaN(count) || count < 1 || count > 100) {
                    alert('Vui l√≤ng nh·∫≠p m·ªôt s·ªë h·ª£p l·ªá t·ª´ 1 ƒë·∫øn 100.');
                    return;
                }
                startQuiz(count);
            });

            nextBtn.addEventListener('click', handleNextQuestion);
            submitBtn.addEventListener('click', () => {
                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën k·∫øt th√∫c b√†i l√†m v√† xem k·∫øt qu·∫£ kh√¥ng?')) {
                    showResults();
                }
            });
            restartBtn.addEventListener('click', () => {
                resultsScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            });
        });
    </script>
</body>
</html>
